<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>My Refund — Processing Technician Assessment</title>

<style>
:root{ --g0:#094B35; }
*{box-sizing:border-box}

body{
  margin:0;
  font-family:"Okta Neue", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  color:#fff;
  background:url("My Refund-Hero Images-02 (1).jpg") center center / cover no-repeat fixed;
}

.header{ background:var(--g0); padding:16px 24px; }
.header-inner{ max-width:1400px; margin:0 auto; display:flex; align-items:center; }
.brand{ display:flex; align-items:center; gap:14px; }
.brand img{ height:28px }
.brand-text strong{ font-size:16px; font-weight:900; }

.page{ min-height:calc(100vh - 72px); display:flex; }
.left{ padding:56px; width:100%; }

.card{
  background:var(--g0);
  border-radius:18px;
  padding:28px;
  max-width:820px;
  box-shadow:0 20px 40px rgba(0,0,0,.35);
}

.progress{ font-size:13px; font-weight:800; margin-bottom:12px; }
h2{ margin:0 0 10px 0; font-weight:900; }

.instructions{
  font-size:14px;
  margin-bottom:14px;
  line-height:1.45;
  white-space:pre-line;
}

label{ display:block; margin-top:12px; font-weight:800; font-size:14px; }

textarea,input{
  width:100%;
  padding:10px;
  margin-top:8px;
  border-radius:8px;
  border:none;
  font-family:inherit;
  font-size:14px;
}

textarea{ min-height:120px; resize:vertical; }

.actions{
  display:flex;
  justify-content:flex-end;
  margin-top:20px;
}

button{
  background:#fff;
  color:var(--g0);
  border:none;
  border-radius:999px;
  padding:10px 26px;
  font-weight:900;
  cursor:pointer;
}
button:disabled{opacity:0.7; cursor:not-allowed;}

.success-screen{
  text-align:center;
  padding:40px 20px;
}
</style>
</head>

<body>

<div class="header">
  <div class="header-inner">
    <div class="brand">
      <img src="logo.png" alt="My Refund">
      <div class="brand-text">
        <strong>Processing Technician Assessment</strong>
      </div>
    </div>
  </div>
</div>

<div class="page">
  <div class="left">
    <div class="card" id="card">
      <div class="progress" id="progress"></div>
      <div id="content"></div>

      <div class="actions">
        <button id="actionBtn">Next</button>
      </div>
    </div>
  </div>
</div>

<script>
const SUBMIT_URL = "https://script.google.com/macros/s/AKfycbzqt1qFnF1Qgff1O7-lWmlSIem5gEcGW8zPRhmUW6HqHtK06bRoABznXuX7EWj7vWfO/exec";
const storeKey = "processing_technician_assessment_v4";

const data = JSON.parse(localStorage.getItem(storeKey) || "{}");
data.testType = "Processing Technician Assessment";
data.answers = data.answers || {};
data.timing = data.timing || { startedAt:null, submittedAt:null, totalSeconds:0, perQuestion:{} };

let currentStart = null;
let isSubmitting = false;
let i = 0;

const questions = [

{
id:"details",
title:"Candidate Details",
instructions:"Please enter your full name and email address.",
render:()=>`
<input placeholder="Full name" value="${escape(data.name||"")}" oninput="saveField('name',this.value)">
<input placeholder="Email address" value="${escape(data.email||"")}" oninput="saveField('email',this.value)">
`
},

{
id:"shortcuts",
title:"Section 1: Shortcut Keys",
instructions:"Write the correct shortcut keys.",
render:()=>`
<label>Copy:</label>
<input value="${escape(data.answers.copy||"")}" oninput="saveAnswer('copy',this.value)">

<label>Cut:</label>
<input value="${escape(data.answers.cut||"")}" oninput="saveAnswer('cut',this.value)">

<label>Paste:</label>
<input value="${escape(data.answers.paste||"")}" oninput="saveAnswer('paste',this.value)">

<label>Select All:</label>
<input value="${escape(data.answers.selectall||"")}" oninput="saveAnswer('selectall',this.value)">
`
},

{
id:"numerical",
title:"Section 2: Numerical Reasoning",
instructions:"Answer the following questions clearly.",
render:()=>`
<label>1) A client received MSD benefit in June 2024, September 2024 and January 2024.  
How many months did they NOT receive benefits in the 2025 tax year?</label>
<textarea oninput="saveAnswer('benefits',this.value)">${escape(data.answers.benefits||"")}</textarea>

<label>2) Sam earned $20,000 in taxable income.  
10% on income from $0–$10,000  
20% on income above $10,000  
Calculate the total tax payable.</label>
<textarea oninput="saveAnswer('taxcalc',this.value)">${escape(data.answers.taxcalc||"")}</textarea>
`
},

{
id:"writing",
title:"Section 3: Written Communication",
instructions:"Rewrite clearly and professionally.",
render:()=>`
<label>1) “Your refund hasn’t come yet, IRD is just slow.”</label>
<textarea oninput="saveAnswer('rewrite1',this.value)">${escape(data.answers.rewrite1||"")}</textarea>

<label>2) “Oops, the tax codes were off, that’s why there’s a bill.”</label>
<textarea oninput="saveAnswer('rewrite2',this.value)">${escape(data.answers.rewrite2||"")}</textarea>
`
},

{
id:"technical",
title:"Section 4: Technical Tax Knowledge",
instructions:"Answer the following questions.",
render:()=>`
<label>1) When does the 2026 New Zealand tax year start and end?</label>
<textarea oninput="saveAnswer('taxyear',this.value)">${escape(data.answers.taxyear||"")}</textarea>

<label>2) A client earns income only from salaries.  
Which expenses can they claim?</label>
<textarea oninput="saveAnswer('salary_expenses',this.value)">${escape(data.answers.salary_expenses||"")}</textarea>

<label>3) Which types of income must be declared to IRD?</label>
<textarea oninput="saveAnswer('income_types',this.value)">${escape(data.answers.income_types||"")}</textarea>

<label>4) A client earned $150 from a cash job during the tax year.  
Should this income be declared?</label>
<textarea oninput="saveAnswer('cash_declared',this.value)">${escape(data.answers.cash_declared||"")}</textarea>
`
}

];

function save(){ localStorage.setItem(storeKey, JSON.stringify(data)); }
function saveField(k,v){ data[k]=v; save(); }
function saveAnswer(k,v){ data.answers[k]=v; save(); }

function escape(s){
return String(s)
.replace(/&/g,"&amp;")
.replace(/</g,"&lt;")
.replace(/>/g,"&gt;")
.replace(/"/g,"&quot;");
}

function render(){
const q = questions[i];
const btn = document.getElementById("actionBtn");

document.getElementById("progress").textContent =
`Question ${i+1} of ${questions.length}`;

document.getElementById("content").innerHTML =
`<h2>${q.title}</h2>
<div class="instructions">${q.instructions}</div>
${q.render()}`;

if(i === questions.length - 1){
  btn.textContent = "Submit";
  btn.onclick = submitAssessment;
}else{
  btn.textContent = "Next";
  btn.onclick = goNext;
}

currentStart = Date.now();
}

function goNext(){
if(isSubmitting) return;

if(!data.timing.startedAt){
  data.timing.startedAt = new Date().toISOString();
}

endTimer(questions[i].id);
i++;
render();
}

function endTimer(id){
if(!currentStart) return;
const sec = Math.round((Date.now()-currentStart)/1000);
data.timing.perQuestion[id] = (data.timing.perQuestion[id]||0)+sec;
save();
}

async function submitAssessment(){
if(isSubmitting) return;

isSubmitting = true;
endTimer(questions[i].id);

const btn = document.getElementById("actionBtn");
btn.disabled = true;
btn.textContent = "Submitting...";

data.timing.submittedAt = new Date().toISOString();
data.timing.totalSeconds = Math.round(
(new Date(data.timing.submittedAt) - new Date(data.timing.startedAt))/1000
);

save();

try{
await fetch(SUBMIT_URL,{
method:"POST",
body:new URLSearchParams({payload:JSON.stringify(data)})
});
localStorage.removeItem(storeKey);

document.getElementById("card").innerHTML =
`<div class="success-screen">
<h2>Assessment Submitted ✓</h2>
<p>Thank you for completing the assessment.</p>
<p>We will review your submission and be in touch.</p>
</div>`;
}catch(e){
isSubmitting=false;
btn.disabled=false;
btn.textContent="Submit";
alert("Submission failed. Please try again.");
}
}

render();
</script>

</body>
</html>
